# 終売・404 運用メモ（SEO）

## 404 の扱い

- **現状**: `notFound()` ベースで問題なし。`app/not-found.tsx` で表示文言を統一。
- **メタデータ**: App Router では 404 ページに `generateMetadata` を直接持たせられないため、404 時はルートレイアウトのメタデータが使われます。必要なら後から `(not-found)` ルートグループで専用レイアウトを挟み、そこで `metadata: { title: "Page Not Found | Evimeria Home" }` を出す運用が可能です。

---

## 終売フラグ設計案（実装は行わない）

### フラグの持ち方（Shopify）

- **推奨**: 商品の metafield で終売を管理する。
  - 例: `namespace: "custom"`, `key: "discontinued"`, `value: "true"`（または日付で「終売日」を保持）
  - または商品タグに `discontinued` を付与する運用でも可（タグの方が検索・一覧フィルターが簡単な場合あり）。

### 運用方針（301 / 410 / 404）の選び方

| 方針                 | 用途                                                 | 実装のしやすさ                                                                                                                                                               |
| -------------------- | ---------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **301 リダイレクト** | 代替商品・カテゴリに恒常的に誘導したい場合           | リダイレクト先URLを metafield または設定で保持し、商品ページの RSC で `redirect()` を実行。                                                                                  |
| **410 Gone**         | 「廃盤で二度と戻らない」と検索エンジンに伝えたい場合 | Next.js では `next/headers` の `headers()` で `x-nextjs-route-status-code: 410` を返すか、Route Handler で 410 を返す必要あり。商品ページ側で終売なら 410 を返す分岐を追加。 |
| **404 Not Found**    | 単に「このURLは無い」にしたい場合                    | 既存の `notFound()` のまま。終売判定時に `notFound()` を呼ぶ。                                                                                                               |

**注意**: リダイレクト（301）は「勝手なリダイレクト」を避けるため、本ドキュメントでは実装せず、運用方針のみ記載。導入する場合は metafield `custom.redirect_url` などを読み、存在する場合のみ `redirect()` する形にすると安全です。

---

## Cloudflare 側（実装タスク外）

- Search Console 導入後、クロールエラー・ソフト404・アクセス拒否が増えた場合は、Cloudflare で Googlebot 等のボット許可ルールを検討すること。
